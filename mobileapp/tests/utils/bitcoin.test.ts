import { generateKeyPair, signTx } from 'utils/bitcoin'
import { toHexBytes } from 'utils/hex'

describe('bitcoin utils', () => {
  it('should generate random keys', () => {
    const pair = generateKeyPair()
    expect(pair.privateKey).not.toBeFalsy()
    expect(pair.publicKey).not.toBeFalsy()
    expect(pair.publicKey).not.toBe(pair.privateKey)
  })

  it('should sign transaction 2 of 2', () => {
    const rawTx =
      '01000000012a3c2133f9b678877ae4afd5a982bdc453d5e86749722fe189acd5a2c97660f30000000000ffffffff026400000000000000160014a9619fc4a9c6d2d36eb6ace4d5bc9abdbebc8f5cc42200000000000017a914b41d8a3e10f6a407ae80ceea45a8eae867ac78598700000000'
    const privKey =
      'b4cff81a80b341efad81b67fb6f3c23d4f1f4d63ba743f59c987e437f40324b7'
    const redeemScript =
      '522102ab7358f9fba8b2661dc6b489ced6cac0d620eb1de82100e6cf40c404ee44dc3a210346b221a71369a6f70be9660ae560096396cf6813a051fcaf50a418d517007fcb52ae'

    const signedTx = signTx(rawTx, toHexBytes(privKey), redeemScript)
    expect(signedTx).toBe(
      '01000000012a3c2133f9b678877ae4afd5a982bdc453d5e86749722fe189acd5a2c97660f30000000092000047304402200a505e3526df75a3addf672c366f79fe28b3f0220f063f78db8ae4a921d0e97a02207aefa698d8f1a984b93fff4480cd30b5e174832e3dab84365a4766615845c8580147522102ab7358f9fba8b2661dc6b489ced6cac0d620eb1de82100e6cf40c404ee44dc3a210346b221a71369a6f70be9660ae560096396cf6813a051fcaf50a418d517007fcb52aeffffffff026400000000000000160014a9619fc4a9c6d2d36eb6ace4d5bc9abdbebc8f5cc42200000000000017a914b41d8a3e10f6a407ae80ceea45a8eae867ac78598700000000',
    )
  })

  it('should sign transaction 1 of 2', () => {
    const rawTx =
      '0100000001fd1cfe0e425fa3d9dd157688342f21c40a61bc1dbf4e74f74535bacda6d756c30000000000ffffffff0288130000000000001600149a1f2258b26cf001dddb61b300f12e5556ba8640a00f00000000000017a914c0dd8ead47fd8a22d932e73043fa1a62d24b3c4f8700000000'
    const privKey =
      '28c232da3049b4d251062078b54c20202cdc2223ccf3e68a569d7a5faa548cd5'
    const redeemScript =
      '5121020d759a93b4647c2d156838490e95200ca5fbbc23cc9c38d65cc7fabfee900eeb2102c22c6c3b2746bcba0d29bd7e213bf6764c768ceac193084211e5db1dab35538552ae'

    const signedTx = signTx(rawTx, toHexBytes(privKey), redeemScript)
    expect(signedTx).toBe(
      '0100000001fd1cfe0e425fa3d9dd157688342f21c40a61bc1dbf4e74f74535bacda6d756c30000000092004830450221009f9613bcae453573cd207c2b32a1c05e4b4c26af065f7553251bae591c3680790220197ce21e449341fe78f3329d7824151467bd100062935f4dea466503419707bd01475121020d759a93b4647c2d156838490e95200ca5fbbc23cc9c38d65cc7fabfee900eeb2102c22c6c3b2746bcba0d29bd7e213bf6764c768ceac193084211e5db1dab35538552aeffffffff0288130000000000001600149a1f2258b26cf001dddb61b300f12e5556ba8640a00f00000000000017a914c0dd8ead47fd8a22d932e73043fa1a62d24b3c4f8700000000',
    )
  })
})
